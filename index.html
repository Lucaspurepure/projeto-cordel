<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ex01</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Montserrat', sans-serif;
    }
    body {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    form {
      width: 40%;
      background: #fff;
      padding: 20px;
      overflow-y: auto;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .button {
      margin-top: 20px;
      padding: 10px 20px;
      background: #2f3e52;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }
    .add-remove-btn {
      background: #2f3e52;
      color: white;
      border: none;
      padding: 4px 10px;
      cursor: pointer;
      border-radius: 4px;
      font-weight: bold;
      font-size: 18px;
      line-height: 1;
    }
    ul {
      padding-left: 20px;
      margin: 0;
    }
    /* PREVIEW */
    .preview {
      width: 60%;
      background: #ccc;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      overflow: hidden;
      padding: 0;
      position: relative;
    }
    #cv-preview {
      width: 794px;
      height: 1123px;
      background: white;
      display: block;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    /* Modal do Template */
    #templateModal {
      display: none;
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      border: 1px solid #ccc;
      padding: 15px;
      z-index: 1000;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    #templateModal h3 {
      margin-top: 0;
    }
    #templateModal ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #templateModal li {
      margin-bottom: 10px;
    }
    #templateModal button {
      background: #2f3e52;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    /* Mensagem carregando PDF */
    #loading-msg {
      display: none;
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #2f3e52;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 1000;
      font-size: 14px;
    }
    /* Estilo para container dos campos dinâmicos com botão alinhado à direita */
    .add-remove-field {
      display: flex;
      align-items: center;
      margin-top: 8px;
    }
    .add-remove-field input,
    .add-remove-field textarea {
      flex: 1;
      resize: vertical; /* para textarea */
    }
    .add-remove-field button.add-remove-btn {
      margin-left: 8px;
      height: 34px;
      padding: 0 10px;
      flex-shrink: 0;
    }
    /* Especifico para textarea extra experiência */
    #experience-extras-container textarea {
      min-height: 50px;
    }
@media screen and (max-width: 768px) {
  body {
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    margin: 0;
    padding: 0;
  }

  form {
    width: 100% !important;
    height: auto;
    overflow-y: visible;
    padding: 15px;
    box-sizing: border-box;
  }

  .preview {
    width: 100% !important;
    overflow-x: auto;
    
    box-sizing: border-box;
    order: 2; /* força aparecer abaixo do form */
  }

  #cv-preview {
    width: 794px !important;  /* tamanho real A4 */
    height: 1123px !important; /* tamanho real A4 */
    
    transform-origin: top left;
    margin: 0 auto 30px auto;
    display: block;
  }

  #btnTemplateSelector, #download-btn {
    width: 100%;
    margin-top: 10px;
  }

  #templateModal {
    width: 90%;
    left: 5%;
    top: 10%;
    transform: none;
  }
}

  </style>
</head>
<body>

  <form id="cv-form">
    <input type="file" accept="image/*" onchange="carregarImagem(event)">
    <h2>Preencha seu CV</h2>

    <label>Nome</label>
    <input id="name" oninput="updatePreview('name')">

    <label>Cargo</label>
    <input id="position" oninput="updatePreview('position')">

    <label>Telefone</label>
    <div id="phone-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('phone')">+</button>

    <label>Email</label>
    <div id="email-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('email')">+</button>

    <label>Endereço</label>
    <div id="address-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('address')">+</button>

    <label>Website</label>
    <div id="website-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('website')">+</button>

    <label>Perfil</label>
    <textarea id="profile" oninput="updatePreview('profile')"></textarea>

    <label>Experiência Profissional</label>
    <textarea id="experience" oninput="updatePreview('experience')"></textarea>
    <!-- Container para campos extras experiência -->
    <div id="experience-extras-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampoExperiencia()">+</button>

    <label>Formação</label>
    <div id="education-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('education')">+</button>

    <label>Habilidades Técnicas</label>
    <div id="skills-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('skills')">+</button>

    <label>Outras Habilidades</label>
    <div id="other-skills-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('other-skills')">+</button>

    <label>Idiomas</label>
    <div id="languages-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('languages')">+</button>

    <label>Referência</label>
    <textarea id="reference" oninput="updatePreview('reference')"></textarea>

    <div style="margin-top: 20px;">
      <button type="button" class="button" id="btnTemplateSelector">Selecionar Template</button>
      <button type="button" class="button" id="download-btn" onclick="downloadPDF()">Baixar PDF</button>
    </div>
  </form>

  <div class="preview">
    <div id="cv-preview"></div>
  </div>

  <div id="templateModal">
    <h3>Escolha um Template:</h3>
    <ul>
      <li><button onclick="carregarTemplate('template1')">Template 1</button></li>
      <li><button onclick="carregarTemplate('template2')">Template 2</button></li>
      <li><button onclick="carregarTemplate('template3')">Template 3</button></li>
      <li><button onclick="carregarTemplate('template4')">Template 4</button></li>
      <li><button onclick="carregarTemplate('template5')">Template 5</button></li>
    </ul>
    <button onclick="document.getElementById('templateModal').style.display='none'">Fechar</button>
  </div>

  <div id="loading-msg">Gerando PDF, por favor aguarde...</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    document.getElementById("btnTemplateSelector").onclick = function () {
      document.getElementById("templateModal").style.display = "block";
    };

    function carregarTemplate(nome) {
      fetch(`templates/${nome}.html`)
        .then(res => res.text())
        .then(html => {
          document.getElementById("cv-preview").innerHTML = html;
          aplicarTodosOsDados();
        });
      document.getElementById("templateModal").style.display = "none";
    }

    function carregarImagem(event) {
      const arquivo = event.target.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = document.getElementById('preview-foto');
        if(img) img.src = e.target.result;
      };
      if (arquivo) reader.readAsDataURL(arquivo);
    }

    function updatePreview(id) {
      const valor = document.getElementById(id).value.trim();
      const preview = document.getElementById("preview-" + id);
      const titulo = document.getElementById("preview-" + id + "-title");
      if(preview) preview.innerText = valor;
      if(titulo) titulo.style.display = valor ? "block" : "none";

      if(id === 'experience') {
        atualizarListaExperienciaExtrasPreview();
      }
    }

    // Função para adicionar campo extra de experiência profissional
    function adicionarCampoExperiencia() {
      const container = document.getElementById("experience-extras-container");

      const div = document.createElement("div");
      div.className = "add-remove-field";

      const textarea = document.createElement("textarea");
      textarea.placeholder = "Detalhe adicional de experiência";
      textarea.oninput = atualizarListaExperienciaExtrasPreview;

      const btnRemover = document.createElement("button");
      btnRemover.type = "button";
      btnRemover.className = "add-remove-btn";
      btnRemover.textContent = "-";
      btnRemover.onclick = () => {
        container.removeChild(div);
        atualizarListaExperienciaExtrasPreview();
      };

      div.appendChild(textarea);
      div.appendChild(btnRemover);
      container.appendChild(div);
      atualizarListaExperienciaExtrasPreview();
    }

    // Atualiza a pré-visualização da lista extra de experiência profissional
    function atualizarListaExperienciaExtrasPreview() {
      const container = document.getElementById("experience-extras-container");
      const previewListId = "preview-experience-extras-list";

      const preview = document.getElementById(previewListId);
      const titulo = document.getElementById("preview-experience-title");

      if(!preview) return; // preview ainda não carregado

      preview.innerHTML = "";
      let temConteudo = false;

      // Obtem textos dos textareas extras
      const textareas = container.querySelectorAll("textarea");
      textareas.forEach(textarea => {
        if(textarea.value.trim()) {
          const li = document.createElement("li");
          li.textContent = "• " + textarea.value.trim();
          preview.appendChild(li);
          temConteudo = true;
        }
      });

      // Nota: título experiência é controlado pelo texto principal, não alteramos aqui
    }

    function adicionarCampo(tipo) {
      const container = document.getElementById(`${tipo}-container`);
      const div = document.createElement("div");
      div.className = "add-remove-field";

      const input = document.createElement("input");
      input.type = "text";
      input.oninput = () => atualizarListaPreview(tipo);

      const btn = document.createElement("button");
      btn.textContent = "-";
      btn.type = "button";
      btn.className = "add-remove-btn";
      btn.onclick = () => {
        container.removeChild(div);
        atualizarListaPreview(tipo);
      };

      div.appendChild(input);
      div.appendChild(btn);
      container.appendChild(div);
      atualizarListaPreview(tipo);
    }

    function atualizarListaPreview(tipo) {
      const container = document.getElementById(`${tipo}-container`);
      const inputs = container.querySelectorAll("input");
      const preview = document.getElementById(`preview-${tipo}-list`);
      const titulo = document.getElementById(`preview-${tipo}-title`);
      if(!preview) return;

      preview.innerHTML = "";
      let temConteudo = false;
      inputs.forEach(input => {
        if(input.value.trim()) {
          const li = document.createElement("li");
          let icon = "• ";
          if(tipo === "phone") icon = "📞 ";
          else if(tipo === "email") icon = "✉️ ";
          else if(tipo === "address") icon = "🏠 ";
          else if(tipo === "website") icon = "🌐 ";
          li.textContent = icon + input.value;
          preview.appendChild(li);
          temConteudo = true;
        }
      });
      if(titulo) titulo.style.display = temConteudo ? "block" : "none";
    }

    function aplicarTodosOsDados() {
      updatePreview('name');
      updatePreview('position');
      updatePreview('profile');
      updatePreview('experience');
      updatePreview('reference');
      atualizarListaPreview('phone');
      atualizarListaPreview('email');
      atualizarListaPreview('address');
      atualizarListaPreview('website');
      atualizarListaPreview('education');
      atualizarListaPreview('skills');
      atualizarListaPreview('other-skills');
      atualizarListaPreview('languages');
      atualizarListaExperienciaExtrasPreview();
    }

    function downloadPDF() {
  window.scrollTo(0, 0);

  const loading = document.getElementById("loading-msg");
  const button = document.getElementById("download-btn");

  loading.style.display = "block";
  button.disabled = true;

  setTimeout(() => {
    const element = document.getElementById("cv-preview");

    html2pdf().set({
      margin: [0, 0, 0, 0], // Garante zero margem
      filename: "cv.pdf",
      image: { type: "jpeg", quality: 1 }, // Qualidade máxima
      html2canvas: {
        scale: 2,         // Aumenta a nitidez
        scrollY: 0,       // Evita deslocamento na captura
        useCORS: true     // Garante carregamento de imagens externas
      },
      jsPDF: {
        unit: "px",
        format: [794, 1123], // Tamanho exato A4 em pixels
        orientation: "portrait"
      }
    }).from(element).save().then(() => {
      loading.style.display = "none";
      button.disabled = false;
    });
  }, 300); // Tempo de espera reduzido (opcional)
}

  </script>
</body>
</html>
