<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ex01</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Montserrat', sans-serif;
    }
    body {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    form {
      width: 40%;
      background: #fff;
      padding: 20px;
      overflow-y: auto;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }
    input, textarea, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .button {
      margin-top: 20px;
      padding: 10px 20px;
      background: #2f3e52;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }
    .add-remove-btn {
      background: #2f3e52;
      color: white;
      border: none;
      padding: 4px 10px;
      cursor: pointer;
      border-radius: 4px;
      font-weight: bold;
      font-size: 18px;
      line-height: 1;
    }
    ul {
      padding-left: 20px;
      margin: 0;
    }
    /* PREVIEW */
    .preview {
      width: 60%;
      background: #ccc;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      overflow: hidden;
      padding: 0;
      position: relative;
    }
    #cv-preview {
      width: 794px;
      height: 1123px;
      background: white;
      display: block;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    /* Modal do Template */
    #templateModal {
      display: none;
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      
      border: 1px solid #18151570;
      border-radius: 20px;
      z-index: 9999;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      background: rgb(221, 218, 218); 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      width: 60vw;
      
    }
    #templateModal h3 {
      margin-top: 0;
      text-align: center;
    }
    #templateModal ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #templateModal li {
      margin-bottom: 10px;
    }
    #templateModal button {
      background: #2f3e52;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    /* Mensagem carregando PDF */
    #loading-msg {
      display: none;
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #2f3e52;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 1000;
      font-size: 14px;
    }
    /* Estilo para container dos campos dinâmicos com botão alinhado à direita */
    .add-remove-field {
      display: flex;
      align-items: center;
      margin-top: 8px;
    }
    .add-remove-field input,
    .add-remove-field textarea,
    .add-remove-field select {
      flex: 1;
      resize: vertical; /* para textarea */
    }
    .add-remove-field button.add-remove-btn {
      margin-left: 8px;
      height: 34px;
      padding: 0 10px;
      flex-shrink: 0;
    }
    /* Especifico para textarea extra experiência */
    #experience-extras-container textarea {
      min-height: 50px;
    }
    /* Preview barra nivel de idioma */
    .nivel-barra-container {
      width: 150px;
      margin-left: 10px;
    }
    .nivel-barra-fundo {
      width: 100%;
      height: 12px;
      background-color: #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .nivel-barra-preenchida {
      height: 12px;
      background-color: #2f3e52;
      border-radius: 6px;
      transition: width 0.3s ease;
    }
    #mobile-preview-btn {
        display: block;
        margin-top: 20px;
        background: #2f3e52;
        color: white;
        padding: 10px;
        text-align: center;
        border-radius: 4px;
        cursor: pointer;
      }

      .mobile-preview-buttons {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin: 20px;
}

.mobile-preview-buttons button {
  background: #2f3e52;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/*nova funcao de escolha de templates*/
.template-thumb {
    width: 150px;
    height: auto;
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border-radius: 8px;
  }

  .template-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }

  #prevBtn, #nextBtn {
    background: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }

  #prevBtn:hover, #nextBtn:hover {
    background: rgba(255, 217, 0, 0.87);
  }

        /* Adições para Responsividade */
    @media (max-width: 768px) {
      body {
        display: block;
        overflow-y: auto;
        height: auto;
      }
      form {
        width: 100%;
        height: auto;
      }
    
      .preview {
        display: none;
      }
      #cv-preview {
        display: none;
      }

      #mobile-preview-btn {
        display: block;
        margin-top: 20px;
        background: #2f3e52;
        color: white;
        padding: 10px;
        text-align: center;
        border-radius: 4px;
        cursor: pointer;
      }

    }
    #cv-hidden {
      display: none;
    }
    @media print {
    #cv-hidden {
      display: block;
      
      width: 794px;
      height: 1123px;
      display: flex;
      box-sizing: border-box;
    }
    }
    #cv-preview-mobile {
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:10px;
      
    }
  </style>
</head>
<body>

  <form id="cv-form">
    <input type="file" accept="image/*" onchange="carregarImagem(event)">
    <h2>Preencha seu CV</h2>

    <label>Nome</label>
    <input id="name" oninput="updatePreview('name')">

    <label>Cargo</label>
    <input id="position" oninput="updatePreview('position')">

    <label>Telefone</label>
    <div id="phone-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('phone')">+</button>

    <label>Email</label>
    <div id="email-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('email')">+</button>

    <label>Endereço</label>
    <div id="address-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('address')">+</button>

    <label>Website</label>
    <div id="website-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('website')">+</button>

    <label>Perfil</label>
    <textarea id="profile" oninput="updatePreview('profile')"></textarea>

    <label>Experiência Profissional</label>
    <textarea id="experience" oninput="updatePreview('experience')"></textarea>
    <!-- Container para campos extras experiência -->
    <div id="experience-extras-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampoExperiencia()">+</button>

    <label>Formação</label>
    <div id="education-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('education')">+</button>

    <label>Habilidades Técnicas</label>
    <div id="skills-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('skills')">+</button>

    <label>Outras Habilidades</label>
    <div id="other-skills-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampo('other-skills')">+</button>

    <label>Idiomas</label>
    <!-- Aqui a escolha do tipo de nível -->
    <div style="display:flex; gap:10px; align-items:center; margin-bottom:8px;">
      <span style="font-weight:bold;">Tipo de Nível:</span>
      <label><input type="radio" name="nivelTipo" value="select" checked onchange="setIdiomaNivelTipo('select')"> Seletor</label>
      <label><input type="radio" name="nivelTipo" value="range" onchange="setIdiomaNivelTipo('range')"> Barra</label>
    </div>
    <div id="languages-container"></div>
    <button type="button" class="add-remove-btn" onclick="adicionarCampoIdioma()">+</button>

    <label>Referência</label>
    <textarea id="reference" oninput="updatePreview('reference')"></textarea>

    <label>Disponibilidade</label>
    <textarea id="availability" oninput="updatePreview('availability')"></textarea>

    <div style="margin-top: 20px;">
      <button type="button" class="button" id="btnTemplateSelector">Selecionar Template</button>
      <button type="button" class="button" id="download-btn" onclick="downloadPDF()">Baixar PDF</button>
      <button type="button" class="button" id="translate-btn" onclick="alternarIdioma()">Traduzir para Inglês</button>
      <button type="button" class="button" id="btnCorrigirAcentos">Corrigir Acentos</button>
      <input type="color" id="colorPicker" value="#2f3e52" style="width:40px; height:40px; border:none; cursor:pointer; margin-left:10px;" onchange="trocarCor(this.value)">
    </div>

    <div id="mobile-preview-btn" onclick="abrirPreviewMobile()">Ver Pré-visualização</div>
  </form>

  <div class="preview">
    <div id="cv-preview"></div>
  </div>

  <!-- Página de Pré-visualização Mobile -->
  <div id="mobile-preview-page" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:9999; overflow:auto;">
    <div style="background:#2f3e52; color:white; padding:10px; text-align:center; cursor:pointer;" onclick="fecharPreviewMobile()">Voltar ao Formulário</div>
    <div id="cv-preview-mobile" class="cv mobile"></div>

    <div class="mobile-preview-buttons">
    <input type="color" class="button" id="colorPicker" value="#2f3e52" style="width:40px; height:40px; border:none; cursor:pointer; margin-left:10px;" onchange="trocarCor(this.value)">
    <button class="button" onclick="document.getElementById('templateModal').style.display='block'">Selecionar Template</button>
    <button class="button" onclick="downloadPDFMobile()">Baixar PDF</button>
    <button type="button" class="button" id="translate-btn" onclick="alternarIdioma()">Traduzir para Inglês</button>
    <button type="button" class="button" id="btnCorrigirAcentos">Corrigir Acentos</button>
    
    </div>
    <div id="cv-hidden" class="cv hidden"> </div>

  </div>

  

  <div id="templateModal">
  
    <h3>Escolha um Template:</h3>
    
    <div style="position: relative; display: flex; align-items: center; justify-content: center;">
      <button id="prevBtn" style="position: absolute; left: -40px; z-index: 2; font-size: 24px;">&#9664;</button>
      
      <div id="templateCarousel" style="display: flex; overflow: hidden; width: 90%; scroll-behavior: smooth;">
        <div style="display: flex; gap: 10px; transition: transform 0.3s;">
          <img src="img/template1.png" alt="Template 1" onclick="carregarTemplate('template1')" class="template-thumb">
          <img src="img/template2.png" alt="Template 2" onclick="carregarTemplate('template2')" class="template-thumb">
          <img src="img/template3.png" alt="Template 3" onclick="carregarTemplate('template3')" class="template-thumb">
          <img src="img/template4.png" alt="Template 4" onclick="carregarTemplate('template4')" class="template-thumb">
          <img src="img/template5.png" alt="Template 5" onclick="carregarTemplate('template5')" class="template-thumb">
          <img src="img/template6.png" alt="Template 6" onclick="carregarTemplate('template6')" class="template-thumb">
          <img src="img/template7.png" alt="Template 7" onclick="carregarTemplate('template7')" class="template-thumb">
        </div>
      </div>
      
      <button id="nextBtn" style="position: absolute; right: -40px; z-index: 2; font-size: 24px;">&#9654;</button>
    </div>

    <button onclick="document.getElementById('templateModal').style.display='none'" style="margin-top: 20px;">Fechar</button>
  
</div>

  <div id="loading-msg">Gerando PDF, por favor aguarde...</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

 

<script>

// Variável global para armazenar a imagem base64
let imagemBase64 = null;

// Controle do tipo de nível idioma
let idiomaNivelTipo = 'select'; // 'select' ou 'range'

// Template atual selecionado global
let templateAtual = 'template1';

// --- Idiomas ---
function setIdiomaNivelTipo(tipo) {
  idiomaNivelTipo = tipo;
  recriarCamposIdiomas();
  atualizarListaPreview('languages');
}

function recriarCamposIdiomas() {
  const container = document.getElementById("languages-container");
  const valores = [];

  container.querySelectorAll(".add-remove-field").forEach(div => {
    const inputs = div.querySelectorAll("input, select");
    const idioma = inputs[0]?.value || "";
    let nivel = idiomaNivelTipo === 'select' ? (inputs[1]?.value || "Básico") : (inputs[1]?.value || 0);
    valores.push({ idioma, nivel });
  });

  container.innerHTML = "";
  valores.forEach(v => adicionarCampoIdioma(v.idioma, v.nivel));
}

function adicionarCampoIdioma(valorIdioma = "", valorNivel = null) {
  const container = document.getElementById("languages-container");

  const div = document.createElement("div");
  div.className = "add-remove-field";
  div.style.gap = "10px";

  const inputIdioma = document.createElement("input");
  inputIdioma.type = "text";
  inputIdioma.placeholder = "Idioma";
  inputIdioma.value = valorIdioma;
  inputIdioma.oninput = () => atualizarListaPreview('languages');
  inputIdioma.style.flex = "1";

  let nivelInput;
  if (idiomaNivelTipo === 'select') {
    nivelInput = document.createElement("select");
    ["Básico", "Intermediário", "Fluente", "Nativo"].forEach(nivel => {
      const option = document.createElement("option");
      option.value = nivel;
      option.textContent = nivel;
      nivelInput.appendChild(option);
    });
    nivelInput.value = valorNivel || "Básico";
    nivelInput.onchange = () => atualizarListaPreview('languages');
    nivelInput.style.flex = "1";
  } else {
    nivelInput = document.createElement("input");
    nivelInput.type = "range";
    nivelInput.min = 0;
    nivelInput.max = 4;
    nivelInput.step = 1;
    nivelInput.value = valorNivel !== null ? valorNivel : 0;
    nivelInput.style.width = "150px";
    nivelInput.oninput = () => atualizarListaPreview('languages');
  }

  const btnRemover = document.createElement("button");
  btnRemover.type = "button";
  btnRemover.className = "add-remove-btn";
  btnRemover.textContent = "-";
  btnRemover.onclick = () => {
    container.removeChild(div);
    atualizarListaPreview('languages');
  };

  div.appendChild(inputIdioma);
  div.appendChild(nivelInput);
  div.appendChild(btnRemover);

  container.appendChild(div);
  atualizarListaPreview('languages');
}

// --- Carregar template (desktop, mobile e oculto para PDF) ---
function carregarTemplate(nome) {
  templateAtual = nome;

  fetch(`templates/${nome}.html`)
    .then(res => {
      if (!res.ok) throw new Error(`Status HTTP ${res.status}`);
      return res.text();
    })
    .then(html => {
      // Desktop preview
      document.getElementById("cv-preview").innerHTML = html;

      // Mobile preview visível
      const mobilePreview = document.getElementById("cv-preview-mobile");
      if (mobilePreview) mobilePreview.innerHTML = html;

      // Mobile preview oculto (para PDF)
      const hiddenPreview = document.getElementById("cv-hidden");
      if (hiddenPreview) hiddenPreview.innerHTML = html;

      // Aplicar dados nos três previews
      aplicarTodosOsDados();
      atualizarImagemPreview();

      // 👇 Forçar ocultar a preview no mobile após carregar template
      if (window.innerWidth <= 768) {
        document.querySelector('.preview').style.display = 'none';
      }
    })
    .catch(err => {
      console.error("Erro ao carregar template:", err);
      alert("Falha ao carregar template. Veja console.");
    });

  document.getElementById("templateModal").style.display = "none";
}


// --- Imagem do usuário ---
function carregarImagem(event) {
  const arquivo = event.target.files[0];
  const reader = new FileReader();
  reader.onload = function (e) {
    imagemBase64 = e.target.result;
    atualizarImagemPreview();
  };
  if (arquivo) reader.readAsDataURL(arquivo);
}

function atualizarImagemPreview() {
  document.querySelectorAll('#preview-foto').forEach(img => {
    if (img && imagemBase64) img.src = imagemBase64;
  });
}

// --- Atualizar previews ---
function updatePreview(id) {
  const valor = document.getElementById(id).value.trim();
  document.querySelectorAll("#preview-" + id).forEach(p => {
    if (p) p.innerText = valor;
  });
  document.querySelectorAll("#preview-" + id + "-title").forEach(t => {
    if (t) t.style.display = valor ? "block" : "none";
  });

  if (id === 'experience') atualizarListaExperienciaExtrasPreview();
}

// --- Experiência adicional ---
function adicionarCampoExperiencia() {
  const container = document.getElementById("experience-extras-container");

  const div = document.createElement("div");
  div.className = "add-remove-field";
  div.style.gap = "10px";

  const ano = document.createElement("input");
  ano.type = "text";
  ano.placeholder = "Ano";
  ano.style.width = "80px";
  ano.oninput = atualizarListaExperienciaExtrasPreview;

  const descricao = document.createElement("textarea");
  descricao.placeholder = "Detalhe adicional de experiência";
  descricao.style.flex = "1";
  descricao.oninput = atualizarListaExperienciaExtrasPreview;

  const btnRemover = document.createElement("button");
  btnRemover.type = "button";
  btnRemover.className = "add-remove-btn";
  btnRemover.textContent = "-";
  btnRemover.onclick = () => {
    container.removeChild(div);
    atualizarListaExperienciaExtrasPreview();
  };

  div.appendChild(ano);
  div.appendChild(descricao);
  div.appendChild(btnRemover);
  container.appendChild(div);

  atualizarListaExperienciaExtrasPreview();
}

function atualizarListaExperienciaExtrasPreview() {
  const container = document.getElementById("experience-extras-container");
  const previews = document.querySelectorAll("#preview-experience-extras-list");
  const titulos = document.querySelectorAll("#preview-experience-title");

  previews.forEach(preview => preview.innerHTML = "");
  let temConteudo = false;

  const divs = container.querySelectorAll(".add-remove-field");
  divs.forEach(div => {
    const ano = div.querySelector("input");
    const descricao = div.querySelector("textarea");

    if (descricao.value.trim()) {
      const linha = document.createElement("div");
      linha.style.display = "flex";
      linha.style.justifyContent = "space-between";
      linha.style.marginBottom = "5px";

      const spanAno = document.createElement("span");
      spanAno.textContent = ano.value.trim();
      spanAno.style.fontWeight = "bold";
      spanAno.style.width = "100px";

      const spanTexto = document.createElement("span");
      spanTexto.textContent = descricao.value.trim();
      spanTexto.style.flex = "1";

      linha.appendChild(spanAno);
      linha.appendChild(spanTexto);

      previews.forEach(preview => preview.appendChild(linha.cloneNode(true)));
      temConteudo = true;
    }
  });

  const experienciaPrincipal = document.getElementById("experience");
  if (experienciaPrincipal && experienciaPrincipal.value.trim()) temConteudo = true;

  titulos.forEach(titulo => {
    titulo.style.display = temConteudo ? "block" : "none";
  });
}

// --- Campos adicionais ---
function adicionarCampo(tipo) {
  const container = document.getElementById(`${tipo}-container`);

  if (tipo === 'education') {
    const div = document.createElement("div");
    div.className = "add-remove-field";
    div.style.gap = "10px";

    const ano = document.createElement("input");
    ano.type = "text";
    ano.placeholder = "Ano";
    ano.style.width = "80px";
    ano.oninput = () => atualizarListaPreview(tipo);

    const descricao = document.createElement("input");
    descricao.type = "text";
    descricao.placeholder = "Descrição";
    descricao.style.flex = "1";
    descricao.oninput = () => atualizarListaPreview(tipo);

    const btn = document.createElement("button");
    btn.textContent = "-";
    btn.type = "button";
    btn.className = "add-remove-btn";
    btn.onclick = () => {
      container.removeChild(div);
      atualizarListaPreview(tipo);
    };

    div.appendChild(ano);
    div.appendChild(descricao);
    div.appendChild(btn);
    container.appendChild(div);
    atualizarListaPreview(tipo);
  } else {
    const div = document.createElement("div");
    div.className = "add-remove-field";

    const input = document.createElement("input");
    input.type = "text";
    input.oninput = () => atualizarListaPreview(tipo);

    const btn = document.createElement("button");
    btn.textContent = "-";
    btn.type = "button";
    btn.className = "add-remove-btn";
    btn.onclick = () => {
      container.removeChild(div);
      atualizarListaPreview(tipo);
    };

    div.appendChild(input);
    div.appendChild(btn);
    container.appendChild(div);
    atualizarListaPreview(tipo);
  }
}

// --- Atualizar lista preview ---
function atualizarListaPreview(tipo) {
  const container = document.getElementById(`${tipo}-container`);
  const previews = document.querySelectorAll(`#preview-${tipo}-list`);
  const titulos = document.querySelectorAll(`#preview-${tipo}-title`);
  if (!previews.length) return;

  previews.forEach(preview => preview.innerHTML = "");
  let temConteudo = false;

  if (tipo === 'education') {
    const divs = container.querySelectorAll(".add-remove-field");
    divs.forEach(div => {
      const inputs = div.querySelectorAll("input");
      const ano = inputs[0]?.value.trim() || "";
      const descricao = inputs[1]?.value.trim() || "";

      if (descricao) {
        const linha = document.createElement("div");
        linha.style.display = "flex";
        linha.style.justifyContent = "space-between";
        linha.style.marginBottom = "5px";

        const spanAno = document.createElement("span");
        spanAno.textContent = ano;
        spanAno.style.fontWeight = "bold";
        spanAno.style.width = "100px";

        const spanTexto = document.createElement("span");
        spanTexto.textContent = descricao;
        spanTexto.style.flex = "1";

        linha.appendChild(spanAno);
        linha.appendChild(spanTexto);

        previews.forEach(preview => preview.appendChild(linha.cloneNode(true)));
        temConteudo = true;
      }
    });
  } else if (tipo === 'languages') {
    const divs = container.querySelectorAll(".add-remove-field");
    divs.forEach(div => {
      const inputs = div.querySelectorAll("input, select");
      const idioma = inputs[0]?.value.trim() || "";
      let nivel = inputs[1]?.value;

      if (idioma) {
        const linha = document.createElement("div");
        linha.style.display = "flex";
        linha.style.alignItems = "center";
        linha.style.marginBottom = "6px";

        const spanIdioma = document.createElement("span");
        spanIdioma.textContent = idioma;
        spanIdioma.style.fontWeight = "bold";
        spanIdioma.style.width = "150px";
        linha.appendChild(spanIdioma);

        if (idiomaNivelTipo === 'select') {
          const spanNivel = document.createElement("span");
          spanNivel.textContent = nivel;
          spanNivel.style.flex = "1";
          linha.appendChild(spanNivel);
        } else {
          const barraContainer = document.createElement("div");
          barraContainer.className = "nivel-barra-container";

          const barraFundo = document.createElement("div");
          barraFundo.className = "nivel-barra-fundo";

          const barraPreenchida = document.createElement("div");
          barraPreenchida.className = "nivel-barra-preenchida";

          const larguraPerc = Math.min(Math.max(parseInt(nivel), 0), 4) * 25;
          barraPreenchida.style.width = larguraPerc + "%";

          barraFundo.appendChild(barraPreenchida);
          barraContainer.appendChild(barraFundo);
          linha.appendChild(barraContainer);
        }

        previews.forEach(preview => preview.appendChild(linha.cloneNode(true)));
        temConteudo = true;
      }
    });
  } else {
    const inputs = container.querySelectorAll("input");
    inputs.forEach(input => {
      const val = input.value.trim();
      if (val) {
        const li = document.createElement("li");
        let icon = "• ";
        if (tipo === "phone") icon = "📞 ";
        else if (tipo === "email") icon = "✉️ ";
        else if (tipo === "address") icon = "🏠 ";
        else if (tipo === "website") icon = "🌐 ";
        else if (tipo === "skills") icon = "⚙️ ";
        else if (tipo === "other-skills") icon = "⭐ ";
        li.textContent = icon + val;
        previews.forEach(preview => preview.appendChild(li.cloneNode(true)));
        temConteudo = true;
      }
    });
  }

  titulos.forEach(t => t.style.display = temConteudo ? "block" : "none");
}

// --- Aplica todos os dados no preview ---
function aplicarTodosOsDados() {
  updatePreview('name');
  updatePreview('position');
  updatePreview('profile');
  updatePreview('experience');
  updatePreview('reference');
  updatePreview('availability');
  atualizarListaPreview('phone');
  atualizarListaPreview('email');
  atualizarListaPreview('address');
  atualizarListaPreview('website');
  atualizarListaPreview('education');
  atualizarListaPreview('skills');
  atualizarListaPreview('other-skills');
  atualizarListaPreview('languages');
  atualizarListaExperienciaExtrasPreview();
}

// --- Download PDF (desktop) ---
function downloadPDF() {
  window.scrollTo(0, 0);

  const loading = document.getElementById("loading-msg");
  const button = document.getElementById("download-btn");

  loading.style.display = "block";
  button.disabled = true;

  setTimeout(() => {
    const element = document.getElementById("cv-preview");

    html2pdf().set({
      margin: [0, 0, 0, 0],
      filename: "cv.pdf",
      image: { type: "jpeg", quality: 1 },
      html2canvas: {
        scale: 2,
        scrollY: 0,
        useCORS: true
      },
      jsPDF: {
        unit: "px",
        format: [794, 1123],
        orientation: "portrait"
      }
    }).from(element).save().then(() => {
      loading.style.display = "none";
      button.disabled = false;
    });
  }, 300);
}

// --- Download PDF (mobile) ---
function downloadPDFMobile() {
  const el = document.getElementById("cv-hidden");
  const loading = document.getElementById("loading-msg");

  const prevDisplay = el.style.display;
  el.style.display = "block";  // garantir visibilidade

  // Criar <style> temporário para tamanhos fixos
  const pdfStyle = document.createElement("style");
  pdfStyle.id = "pdf-temp-style";
  pdfStyle.innerHTML = `
    #cv-hidden h1 { font-size: 24px !important; }
    #cv-hidden h2 { font-size: 20px !important; }
    #cv-hidden h3 { font-size: 18px !important; }
    #cv-hidden p { font-size: 14px !important; }
    #cv-hidden li { font-size: 14px !important; }
    #cv-hidden img { max-width: 100px !important; height: auto !important; }
  `;
  document.head.appendChild(pdfStyle);

  loading.style.display = "block";

  html2pdf().set({
    margin: [0, 0, 0, 0],
    filename: "cv.pdf",
    image: { type: "jpeg", quality: 1 },
    html2canvas: { scale: 2, scrollY: 0, useCORS: true },
    jsPDF: { unit: "px", format: [794, 1123], orientation: "portrait" }
  }).from(el).save().then(() => {
    // Restaurar estado
    el.style.display = prevDisplay;
    loading.style.display = "none";

    // Remover estilo temporário
    const temp = document.getElementById("pdf-temp-style");
    if (temp) temp.remove();
  });
}


// --- Abrir preview mobile ---
function abrirPreviewMobile() {
  document.getElementById('mobile-preview-page').style.display = 'block';
}

// --- Fechar preview mobile ---
function fecharPreviewMobile() {
  document.getElementById('mobile-preview-page').style.display = 'none';
}

// --- Eventos ---
document.getElementById("btnTemplateSelector").addEventListener("click", () => {
  document.getElementById("templateModal").style.display = "block";
});

// --- Carrega template ao iniciar página ---
window.addEventListener("DOMContentLoaded", function () {
  const urlParams = new URLSearchParams(window.location.search);
  const template = urlParams.get('template') || 'template1';
  carregarTemplate(template);
});

//trocar de cor
function trocarCor(corHex) {
  document.documentElement.style.setProperty('--main-color', corHex);
}

</script>
<script>
  //traduzir documento
let idiomaAtual = 'pt'; // pt ou en

const dicionarioTitulos = {
  'pt': {
    'profile': 'Perfil',
    'experience': 'Experiência Profissional',
    'education': 'Formação',
    'skills': 'Habilidades Técnicas',
    'other-skills': 'Outras Habilidades',
    'languages': 'Idiomas',
    'reference': 'Referência',
    'availability': 'Disponibilidade',
    'contacts': 'Contactos',
    'Básico': 'Básico',
    'Intermediário': 'Intermediário',
    'Fluente': 'Fluente',
    'Nativo': 'Nativo'
  },
  'en': {
    'profile': 'Profile',
    'experience': 'Professional Experience',
    'education': 'Education',
    'skills': 'Technical Skills',
    'other-skills': 'Other Skills',
    'languages': 'Languages',
    'reference': 'Reference',
    'availability': 'Availability',
    'contacts': 'Contacts',
    'Básico': 'Basic',
    'Intermediário': 'Intermediate',
    'Fluente': 'Fluent',
    'Nativo': 'Native'
  }
};

async function traduzirTextoGoogle(texto, de, para) {
  const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${de}&tl=${para}&dt=t&q=${encodeURIComponent(texto)}`;
  const response = await fetch(url);
  const data = await response.json();
  return data[0]?.[0]?.[0] || texto;
}

async function traduzirCamposCV() {
  const campos = ['name', 'position', 'profile', 'experience', 'reference', 'availability'];
  for (let id of campos) {
    const el = document.getElementById(id);
    if (el && el.value.trim() !== '') {
      const textoTraduzido = await traduzirTextoGoogle(el.value.trim(), idiomaAtual, idiomaAtual === 'pt' ? 'en' : 'pt');
      el.value = textoTraduzido;
      updatePreview(id);
    }
  }

  // Campos Dinâmicos (Educação, Skills, etc.)
  const containers = ['education', 'skills', 'other-skills', 'phone', 'email', 'address', 'website'];
  for (let tipo of containers) {
    const container = document.getElementById(`${tipo}-container`);
    if (container) {
      const inputs = container.querySelectorAll('input');
      for (let input of inputs) {
        if (input.value.trim() !== '') {
          const textoTraduzido = await traduzirTextoGoogle(input.value.trim(), idiomaAtual, idiomaAtual === 'pt' ? 'en' : 'pt');
          input.value = textoTraduzido;
        }
      }
      atualizarListaPreview(tipo);
    }
  }

  // Idiomas (Nome do Idioma)
  const languages = document.getElementById('languages-container').querySelectorAll('.add-remove-field input[type="text"]');
  for (let input of languages) {
    if (input.value.trim() !== '') {
      const textoTraduzido = await traduzirTextoGoogle(input.value.trim(), idiomaAtual, idiomaAtual === 'pt' ? 'en' : 'pt');
      input.value = textoTraduzido;
    }
  }

  // Traduzir Níveis (Básico, Intermediário, etc.)
  const niveis = document.getElementById('languages-container').querySelectorAll('select');
  niveis.forEach(select => {
    const nivelAtual = select.value;
    const novoNivel = dicionarioTitulos[idiomaAtual === 'pt' ? 'en' : 'pt'][nivelAtual];
    if (novoNivel) select.value = novoNivel;
  });

  atualizarListaPreview('languages');

  // Campos Extras Experiência
  const experienceExtras = document.getElementById('experience-extras-container').querySelectorAll('textarea');
  for (let textarea of experienceExtras) {
    if (textarea.value.trim() !== '') {
      const textoTraduzido = await traduzirTextoGoogle(textarea.value.trim(), idiomaAtual, idiomaAtual === 'pt' ? 'en' : 'pt');
      textarea.value = textoTraduzido;
    }
  }
  atualizarListaExperienciaExtrasPreview();

  // Agora traduzir os TÍTULOS da pré-visualização
  traduzirTitulosPreview();
}

function traduzirTitulosPreview() {
  const titulosKeys = ['profile', 'experience', 'education', 'skills', 'other-skills', 'languages', 'reference', 'availability', 'contacts'];
  titulosKeys.forEach(chave => {
    document.querySelectorAll(`#preview-${chave}-title`).forEach(el => {
      el.textContent = dicionarioTitulos[idiomaAtual === 'pt' ? 'en' : 'pt'][chave];
    });
  });

  // Atualizar níveis nas barras se for barra de nível
  const bars = document.querySelectorAll('#languages-container select');
  bars.forEach(select => {
    const options = select.options;
    for (let i = 0; i < options.length; i++) {
      const val = options[i].value;
      const novaLabel = dicionarioTitulos[idiomaAtual === 'pt' ? 'en' : 'pt'][val];
      if (novaLabel) options[i].textContent = novaLabel;
    }
  });
}

async function alternarIdioma() {
  const botao = event.target;
  botao.textContent = 'Traduzindo...';
  botao.disabled = true;

  await traduzirCamposCV();

  idiomaAtual = idiomaAtual === 'pt' ? 'en' : 'pt';
  botao.textContent = idiomaAtual === 'pt' ? 'Traduzir para Inglês' : 'Traduzir para Português';
  botao.disabled = false;
}

</script>

<script>
document.getElementById('btnCorrigirAcentos').addEventListener('click', async () => {
  const botao = document.getElementById('btnCorrigirAcentos');
  botao.disabled = true;
  botao.textContent = 'Corrigindo...';

  await corrigirCamposCV2x();

  botao.disabled = false;
  botao.textContent = 'Corrigir Acentos';
});

async function corrigirCamposCV2x() {
  const campos = ['name', 'position', 'profile', 'experience', 'reference', 'availability'];
  for (let id of campos) {
    const el = document.getElementById(id);
    if (el && el.value.trim() !== '') {
      // 1ª tradução: pt → en
      let textoIntermediario = await traduzirTextoGoogle(el.value.trim(), 'pt', 'en');
      // 2ª tradução: en → pt
      const textoCorrigido = await traduzirTextoGoogle(textoIntermediario, 'en', 'pt');
      el.value = textoCorrigido;
      updatePreview(id);
    }
  }

  const containers = ['education', 'skills', 'other-skills', 'phone', 'email', 'address', 'website'];
  for (let tipo of containers) {
    const container = document.getElementById(`${tipo}-container`);
    if (container) {
      const inputs = container.querySelectorAll('input');
      for (let input of inputs) {
        if (input.value.trim() !== '') {
          let textoIntermediario = await traduzirTextoGoogle(input.value.trim(), 'pt', 'en');
          const textoCorrigido = await traduzirTextoGoogle(textoIntermediario, 'en', 'pt');
          input.value = textoCorrigido;
        }
      }
      atualizarListaPreview(tipo);
    }
  }

  const languages = document.getElementById('languages-container').querySelectorAll('.add-remove-field input[type="text"]');
  for (let input of languages) {
    if (input.value.trim() !== '') {
      let textoIntermediario = await traduzirTextoGoogle(input.value.trim(), 'pt', 'en');
      const textoCorrigido = await traduzirTextoGoogle(textoIntermediario, 'en', 'pt');
      input.value = textoCorrigido;
    }
  }

  atualizarListaPreview('languages');

  const experienceExtras = document.getElementById('experience-extras-container').querySelectorAll('textarea');
  for (let textarea of experienceExtras) {
    if (textarea.value.trim() !== '') {
      let textoIntermediario = await traduzirTextoGoogle(textarea.value.trim(), 'pt', 'en');
      const textoCorrigido = await traduzirTextoGoogle(textoIntermediario, 'en', 'pt');
      textarea.value = textoCorrigido;
    }
  }
  atualizarListaExperienciaExtrasPreview();
}
</script>
<script>
  //template modal nova funcao
  const carousel = document.getElementById('templateCarousel');
  const scrollAmount = 160;

  document.getElementById('prevBtn').addEventListener('click', () => {
    carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
  });

  document.getElementById('nextBtn').addEventListener('click', () => {
    carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
  });
</script>

</body>
</html>
